{"version":3,"file":"brooklyn-ai-planner/view.js","mappings":"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","sources":["webpack://brooklyn-ai-planner/./src/brooklyn-ai-planner/view.js"],"sourcesContent":["/* eslint-env browser */\n/* eslint-disable no-console, no-alert */\n/* global google */\n\nconst initItineraryForm = () => {\n\tconst form = document.querySelector( '[data-batp-itinerary-form]' );\n\tif ( ! form ) {\n\t\treturn;\n\t}\n\n\t// Selectors\n\tconst resultsArea = document.getElementById( 'batp-results-area' );\n\tconst listOutput = document.getElementById( 'batp-list-output' );\n\tconst mapContainer = document.getElementById( 'batp-map-root' );\n\tconst metaText = document.querySelector( '[data-batp-results-meta]' );\n\tconst tabs = document.querySelectorAll( '.batp-tabs__btn' );\n\n\tconst chips = Array.from(\n\t\tform.querySelectorAll( '.batp-form__chip input[type=\"checkbox\"]' )\n\t);\n\n\t// 0. Location Selection (Neighborhood + Geolocation)\n\tconst neighborhoodSelect = document.getElementById(\n\t\t'batp-neighborhood-select'\n\t);\n\tconst latInput = document.getElementById( 'batp-lat-input' );\n\tconst lngInput = document.getElementById( 'batp-lng-input' );\n\tconst locationStatus = document.getElementById( 'batp-location-status' );\n\n\t// Set initial coords from selected option\n\tconst setLocationFromOption = ( option ) => {\n\t\tif ( option && option.dataset.lat && option.dataset.lng ) {\n\t\t\tlatInput.value = option.dataset.lat;\n\t\t\tlngInput.value = option.dataset.lng;\n\t\t\tif ( locationStatus ) {\n\t\t\t\tlocationStatus.textContent = '';\n\t\t\t}\n\t\t}\n\t};\n\n\t// Initialize with default selection\n\tif ( neighborhoodSelect ) {\n\t\tconst selectedOption =\n\t\t\tneighborhoodSelect.options[ neighborhoodSelect.selectedIndex ];\n\t\tsetLocationFromOption( selectedOption );\n\n\t\tneighborhoodSelect.addEventListener( 'change', ( e ) => {\n\t\t\tconst option = e.target.options[ e.target.selectedIndex ];\n\n\t\t\tif ( option.value === 'current_location' ) {\n\t\t\t\t// Trigger geolocation\n\t\t\t\tif ( locationStatus ) {\n\t\t\t\t\tlocationStatus.textContent = 'üì° Getting location...';\n\t\t\t\t}\n\n\t\t\t\tif ( navigator.geolocation ) {\n\t\t\t\t\tnavigator.geolocation.getCurrentPosition(\n\t\t\t\t\t\t( position ) => {\n\t\t\t\t\t\t\tlatInput.value = position.coords.latitude;\n\t\t\t\t\t\t\tlngInput.value = position.coords.longitude;\n\t\t\t\t\t\t\tif ( locationStatus ) {\n\t\t\t\t\t\t\t\tlocationStatus.textContent =\n\t\t\t\t\t\t\t\t\t'‚úÖ Location found!';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'BATP Geolocation:',\n\t\t\t\t\t\t\t\tposition.coords.latitude,\n\t\t\t\t\t\t\t\tposition.coords.longitude\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t( error ) => {\n\t\t\t\t\t\t\tconsole.error( 'Geolocation error:', error );\n\t\t\t\t\t\t\tif ( locationStatus ) {\n\t\t\t\t\t\t\t\tlocationStatus.textContent =\n\t\t\t\t\t\t\t\t\t'‚ùå Location failed';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\talert(\n\t\t\t\t\t\t\t\t'Could not get your location. Please select a neighborhood.'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tneighborhoodSelect.value = 'Brooklyn Heights';\n\t\t\t\t\t\t\tsetLocationFromOption(\n\t\t\t\t\t\t\t\tneighborhoodSelect.options[\n\t\t\t\t\t\t\t\t\tneighborhoodSelect.selectedIndex\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ enableHighAccuracy: true, timeout: 10000 }\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\talert( 'Geolocation is not supported by your browser.' );\n\t\t\t\t\tneighborhoodSelect.value = 'Brooklyn Heights';\n\t\t\t\t\tsetLocationFromOption(\n\t\t\t\t\t\tneighborhoodSelect.options[\n\t\t\t\t\t\t\tneighborhoodSelect.selectedIndex\n\t\t\t\t\t\t]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetLocationFromOption( option );\n\t\t\t}\n\t\t} );\n\t}\n\n\t// 1. Chip Interactions\n\tchips.forEach( ( input ) => {\n\t\tinput.addEventListener( 'change', () => {\n\t\t\tinput\n\t\t\t\t.closest( '.batp-form__chip' )\n\t\t\t\t.classList.toggle( 'is-selected', input.checked );\n\t\t} );\n\t} );\n\n\t// 2. Tabs Interaction\n\ttabs.forEach( ( tab ) => {\n\t\ttab.addEventListener( 'click', () => {\n\t\t\t// Toggle active tab state\n\t\t\ttabs.forEach( ( t ) => t.classList.remove( 'is-active' ) );\n\t\t\ttab.classList.add( 'is-active' );\n\n\t\t\t// Toggle content view\n\t\t\tconst targetId = tab.dataset.tab; // 'list' or 'map'\n\t\t\tdocument\n\t\t\t\t.querySelectorAll( '.batp-view-content' )\n\t\t\t\t.forEach( ( content ) => {\n\t\t\t\t\tcontent.classList.remove( 'is-active' );\n\t\t\t\t} );\n\t\t\tdocument\n\t\t\t\t.getElementById( `batp-view-${ targetId }` )\n\t\t\t\t.classList.add( 'is-active' );\n\n\t\t\t// If switching to map, resize trigger might be needed\n\t\t\tif ( targetId === 'map' && googleMap ) {\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tgoogle.maps.event.trigger( googleMap, 'resize' );\n\t\t\t\t}, 100 );\n\t\t\t}\n\t\t} );\n\t} );\n\n\t// 3. Map Logic\n\tlet googleMap = null;\n\n\tconst waitForGoogleMaps = () => {\n\t\treturn new Promise( ( resolve, reject ) => {\n\t\t\tlet attempts = 0;\n\t\t\tconst check = () => {\n\t\t\t\tattempts++;\n\t\t\t\tif (\n\t\t\t\t\twindow.google &&\n\t\t\t\t\twindow.google.maps &&\n\t\t\t\t\twindow.google.maps.Map\n\t\t\t\t) {\n\t\t\t\t\tresolve();\n\t\t\t\t} else if ( attempts > 50 ) {\n\t\t\t\t\t// 5 seconds timeout\n\t\t\t\t\treject(\n\t\t\t\t\t\tnew Error( 'Timeout waiting for google.maps.Map' )\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout( check, 100 );\n\t\t\t\t}\n\t\t\t};\n\t\t\tcheck();\n\t\t} );\n\t};\n\n\tconst loadGoogleMaps = ( apiKey ) => {\n\t\treturn new Promise( ( resolve, reject ) => {\n\t\t\tif ( window.google && window.google.maps ) {\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst existingScript = document.querySelector(\n\t\t\t\t`script[src*=\"maps.googleapis.com/maps/api/js\"]`\n\t\t\t);\n\t\t\tif ( existingScript ) {\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst script = document.createElement( 'script' );\n\t\t\tscript.src = `https://maps.googleapis.com/maps/api/js?key=${ apiKey }&libraries=places,geometry,marker&v=weekly&loading=async`;\n\t\t\tscript.async = true;\n\t\t\tscript.defer = true;\n\t\t\tscript.onload = () => resolve();\n\t\t\tscript.onerror = ( err ) => reject( err );\n\t\t\tdocument.head.appendChild( script );\n\t\t} );\n\t};\n\n\tconst initMap = async ( apiKey, locations = [] ) => {\n\t\tif ( ! mapContainer ) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait loadGoogleMaps( apiKey );\n\t\t\tawait waitForGoogleMaps();\n\n\t\t\t// Compatibility Layer\n\t\t\tlet MapConstructor, AdvancedMarkerElement;\n\t\t\tlet useLegacyMarkers = false;\n\n\t\t\tif ( typeof google.maps.importLibrary === 'function' ) {\n\t\t\t\ttry {\n\t\t\t\t\tconst { Map } = await google.maps.importLibrary( 'maps' );\n\t\t\t\t\tconst { AdvancedMarkerElement: AME } =\n\t\t\t\t\t\tawait google.maps.importLibrary( 'marker' );\n\t\t\t\t\tMapConstructor = Map;\n\t\t\t\t\tAdvancedMarkerElement = AME;\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Modern map import failed, falling back to legacy',\n\t\t\t\t\t\te\n\t\t\t\t\t);\n\t\t\t\t\tMapConstructor = google.maps.Map;\n\t\t\t\t\tuseLegacyMarkers = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tMapConstructor = google.maps.Map;\n\t\t\t\tuseLegacyMarkers = true;\n\t\t\t}\n\n\t\t\tif ( ! MapConstructor ) {\n\t\t\t\tthrow new Error( 'google.maps.Map constructor is missing' );\n\t\t\t}\n\n\t\t\tconst center =\n\t\t\t\tlocations.length > 0\n\t\t\t\t\t? { lat: locations[ 0 ].lat, lng: locations[ 0 ].lng }\n\t\t\t\t\t: { lat: 40.6782, lng: -73.9442 }; // Default: Brooklyn\n\n\t\t\tgoogleMap = new MapConstructor( mapContainer, {\n\t\t\t\tcenter,\n\t\t\t\tzoom: 13,\n\t\t\t\tmapId: 'DEMO_MAP_ID',\n\t\t\t\tdisableDefaultUI: false, // Allow controls for better UX in full view\n\t\t\t\tzoomControl: true,\n\t\t\t\tstreetViewControl: false,\n\t\t\t} );\n\n\t\t\tif ( locations.length > 0 ) {\n\t\t\t\tconst bounds = new google.maps.LatLngBounds();\n\n\t\t\t\tlocations.forEach( ( loc, index ) => {\n\t\t\t\t\tconst position = { lat: loc.lat, lng: loc.lng };\n\n\t\t\t\t\tif ( ! useLegacyMarkers && AdvancedMarkerElement ) {\n\t\t\t\t\t\t// Modern: Advanced Marker\n\t\t\t\t\t\tconst markerContent = document.createElement( 'div' );\n\t\t\t\t\t\tmarkerContent.className = 'batp-map-marker';\n\t\t\t\t\t\tmarkerContent.innerHTML = `<span style=\"background:#FF5F3D; color:#fff; border-radius:50%; width:32px; height:32px; display:flex; align-items:center; justify-content:center; font-weight:bold; box-shadow:0 2px 4px rgba(0,0,0,0.2); font-size:14px;\">${\n\t\t\t\t\t\t\tindex + 1\n\t\t\t\t\t\t}</span>`;\n\n\t\t\t\t\t\tnew AdvancedMarkerElement( {\n\t\t\t\t\t\t\tmap: googleMap,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tcontent: markerContent,\n\t\t\t\t\t\t\ttitle: loc.title,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Legacy: Standard Marker\n\t\t\t\t\t\tnew google.maps.Marker( {\n\t\t\t\t\t\t\tmap: googleMap,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\t\ttext: ( index + 1 ).toString(),\n\t\t\t\t\t\t\t\tcolor: 'white',\n\t\t\t\t\t\t\t\tfontWeight: 'bold',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttitle: loc.title,\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\tbounds.extend( position );\n\t\t\t\t} );\n\n\t\t\t\tgoogleMap.fitBounds( bounds );\n\t\t\t}\n\t\t} catch ( error ) {\n\t\t\tconsole.error( 'Map init error:', error );\n\t\t\tmapContainer.innerHTML = `<div style=\"padding:2rem; color:#d00;\">Map failed to load.</div>`;\n\t\t}\n\t};\n\n\tconst renderResults = ( data, apiKey ) => {\n\t\tconst itineraryItems = data.itinerary?.items || [];\n\t\tif ( itineraryItems.length === 0 ) {\n\t\t\talert( 'No results found. Try different filters.' );\n\t\t\treturn;\n\t\t}\n\n\t\t// Reveal Results Area\n\t\tif ( resultsArea ) {\n\t\t\tresultsArea.classList.add( 'is-active' );\n\t\t\tresultsArea.scrollIntoView( { behavior: 'smooth' } );\n\t\t}\n\n\t\t// Update Meta Text\n\t\tif ( metaText ) {\n\t\t\tconst duration = form.querySelector(\n\t\t\t\t'select[name=\"duration\"]'\n\t\t\t).value;\n\t\t\tmetaText.textContent = `${ itineraryItems.length } venues found ‚Ä¢ ${ duration } hours available`;\n\t\t}\n\n\t\t// Build Map Locations and Candidate Map\n\t\tconst locations = [];\n\t\tconst candidateMap = new Map(\n\t\t\t( data.candidates || [] ).map( ( c ) => [ c.slug, c ] )\n\t\t);\n\n\t\t// Store directions URL from API response\n\t\tconst multiStopDirectionsUrl = data.directions?.overview_url || '#';\n\n\t\titineraryItems.forEach( ( item, idx ) => {\n\t\t\tconst candidate = candidateMap.get( item.slug );\n\t\t\tconst lat = candidate?.data?.latitude;\n\t\t\tconst lng = candidate?.data?.longitude;\n\n\t\t\t// Debug: Log each item's location data\n\t\t\tconsole.log( `BATP Map: Item ${ idx + 1 } (${ item.slug }):`, {\n\t\t\t\tlat,\n\t\t\t\tlng,\n\t\t\t\ttitle: item.title,\n\t\t\t} );\n\n\t\t\tif ( lat && lng && lat !== 0 && lng !== 0 ) {\n\t\t\t\tlocations.push( {\n\t\t\t\t\tlat: parseFloat( lat ),\n\t\t\t\t\tlng: parseFloat( lng ),\n\t\t\t\t\ttitle: item.title,\n\t\t\t\t\tplaceId: item.slug, // For analytics\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`BATP Map: Missing coordinates for item ${ idx + 1 }: ${\n\t\t\t\t\t\titem.title\n\t\t\t\t\t}`\n\t\t\t\t);\n\t\t\t}\n\t\t} );\n\n\t\tconsole.log( 'BATP Map: Total locations for map:', locations.length );\n\n\t\t// Helper: Format Hours\n\t\tconst getHoursString = ( hoursData ) => {\n\t\t\tif ( ! hoursData ) {\n\t\t\t\treturn 'See website for hours';\n\t\t\t}\n\t\t\t// Simple check for today's day (0=Sun, 1=Mon...)\n\t\t\tconst days = [\n\t\t\t\t'Sunday',\n\t\t\t\t'Monday',\n\t\t\t\t'Tuesday',\n\t\t\t\t'Wednesday',\n\t\t\t\t'Thursday',\n\t\t\t\t'Friday',\n\t\t\t\t'Saturday',\n\t\t\t];\n\t\t\tconst dayName = days[ new Date().getDay() ];\n\t\t\treturn hoursData[ dayName ] || 'Open today';\n\t\t};\n\n\t\t// Build multi-stop directions URL\n\t\tconst buildMultiStopUrl = ( locs ) => {\n\t\t\tif ( locs.length === 0 ) {\n\t\t\t\treturn '#';\n\t\t\t}\n\t\t\tconst origin = `${ locs[ 0 ].lat },${ locs[ 0 ].lng }`;\n\t\t\tconst destination = `${ locs[ locs.length - 1 ].lat },${\n\t\t\t\tlocs[ locs.length - 1 ].lng\n\t\t\t}`;\n\t\t\tconst waypoints = locs\n\t\t\t\t.slice( 1, -1 )\n\t\t\t\t.map( ( l ) => `${ l.lat },${ l.lng }` )\n\t\t\t\t.join( '|' );\n\t\t\tlet url = `https://www.google.com/maps/dir/?api=1&origin=${ origin }&destination=${ destination }&travelmode=walking`;\n\t\t\tif ( waypoints ) {\n\t\t\t\turl += `&waypoints=${ waypoints }`;\n\t\t\t}\n\t\t\treturn url;\n\t\t};\n\n\t\t// Use API-provided URL or build our own\n\t\tconst fullRouteUrl =\n\t\t\tmultiStopDirectionsUrl !== '#'\n\t\t\t\t? multiStopDirectionsUrl\n\t\t\t\t: buildMultiStopUrl( locations );\n\n\t\t// Helper: Generate description from venue data\n\t\tconst generateDescription = ( details, itemDesc ) => {\n\t\t\tif ( itemDesc && itemDesc.length > 10 ) {\n\t\t\t\treturn itemDesc;\n\t\t\t}\n\t\t\tif ( details.vibe_summary ) {\n\t\t\t\treturn details.vibe_summary;\n\t\t\t}\n\n\t\t\t// Build from available data\n\t\t\tconst parts = [];\n\t\t\tconst rating = details.rating ? `${ details.rating }‚òÖ` : '';\n\t\t\tconst priceLevel = details.price_level\n\t\t\t\t? '$'.repeat( details.price_level )\n\t\t\t\t: '';\n\t\t\tconst types =\n\t\t\t\tdetails.types\n\t\t\t\t\t?.slice( 0, 2 )\n\t\t\t\t\t.map( ( t ) => t.replace( /_/g, ' ' ) )\n\t\t\t\t\t.join( ', ' ) || '';\n\n\t\t\tif ( rating ) {\n\t\t\t\tparts.push( `Rated ${ rating }` );\n\t\t\t}\n\t\t\tif ( priceLevel ) {\n\t\t\t\tparts.push( priceLevel );\n\t\t\t}\n\t\t\tif ( types ) {\n\t\t\t\tparts.push( types );\n\t\t\t}\n\n\t\t\treturn parts.length > 0\n\t\t\t\t? parts.join( ' ‚Ä¢ ' )\n\t\t\t\t: 'A local Brooklyn favorite.';\n\t\t};\n\n\t\t// State for editable itinerary\n\t\tlet currentItems = [ ...itineraryItems ];\n\n\t\t// All candidates for replacement options\n\t\tconst allCandidates = data.candidates || [];\n\n\t\t// Get available replacements (candidates not in current itinerary)\n\t\tconst getAvailableReplacements = () => {\n\t\t\tconst currentSlugs = new Set( currentItems.map( ( i ) => i.slug ) );\n\t\t\treturn allCandidates.filter(\n\t\t\t\t( c ) => ! currentSlugs.has( c.slug )\n\t\t\t);\n\t\t};\n\n\t\t// Replace modal state\n\t\tlet replacingSlug = null;\n\n\t\t// Render List View (Cards)\n\t\tconst renderList = ( items ) => {\n\t\t\tif ( ! listOutput ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Add multi-stop directions header\n\t\t\tconst headerHtml = `\n\t\t\t\t<div class=\"batp-route-header\">\n\t\t\t\t\t<a href=\"${ fullRouteUrl }\" target=\"_blank\" class=\"batp-route-btn\" data-event-action=\"directions_click\" data-place-id=\"full_route\">\n\t\t\t\t\t\t<span class=\"dashicons dashicons-location-alt\"></span> \n\t\t\t\t\t\t<strong>Get Full Route Directions</strong>\n\t\t\t\t\t\t<span class=\"batp-route-btn__subtitle\">Open all ${ items.length } stops in Google Maps</span>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tlistOutput.innerHTML =\n\t\t\t\theaderHtml +\n\t\t\t\titems\n\t\t\t\t\t.map( ( item, index ) => {\n\t\t\t\t\t\tconst candidate = candidateMap.get( item.slug );\n\t\t\t\t\t\tconst details = candidate?.data || {};\n\t\t\t\t\t\tconst website = details.website || '#';\n\t\t\t\t\t\tconst phone =\n\t\t\t\t\t\t\tdetails.phone_number || details.phone || '';\n\t\t\t\t\t\tconst address = details.address || '';\n\t\t\t\t\t\tconst description = generateDescription(\n\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\titem.description\n\t\t\t\t\t\t);\n\t\t\t\t\t\tlet hours = 'See hours on website';\n\t\t\t\t\t\tif ( details.hours ) {\n\t\t\t\t\t\t\thours = getHoursString( details.hours );\n\t\t\t\t\t\t} else if ( details.opening_hours?.open_now ) {\n\t\t\t\t\t\t\thours = 'Open now';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Single venue directions URL (fallback)\n\t\t\t\t\t\tlet dirUrl = '#';\n\t\t\t\t\t\tif ( details.latitude && details.longitude ) {\n\t\t\t\t\t\t\tdirUrl = `https://www.google.com/maps/dir/?api=1&destination=${ details.latitude },${ details.longitude }`;\n\t\t\t\t\t\t} else if ( address ) {\n\t\t\t\t\t\t\tdirUrl = `https://www.google.com/maps/dir/?api=1&destination=${ encodeURIComponent(\n\t\t\t\t\t\t\t\taddress\n\t\t\t\t\t\t\t) }`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdirUrl = `https://www.google.com/maps/dir/?api=1&destination=${ encodeURIComponent(\n\t\t\t\t\t\t\t\titem.title + ', Brooklyn, NY'\n\t\t\t\t\t\t\t) }`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Place ID for analytics (Google Places ID)\n\t\t\t\t\t\tconst placeId = candidate?.place_id || item.slug || '';\n\n\t\t\t\t\t\treturn `\n\t\t\t\t<div class=\"batp-card\" data-slug=\"${\n\t\t\t\t\titem.slug\n\t\t\t\t}\" data-access='${ JSON.stringify(\n\t\t\t\t\tdetails.accessibility || []\n\t\t\t\t) }'>\n\t\t\t\t\t<div class=\"batp-card__actions\">\n\t\t\t\t\t\t<button class=\"batp-card__replace\" data-replace-slug=\"${\n\t\t\t\t\t\t\titem.slug\n\t\t\t\t\t\t}\" data-replace-title=\"${\n\t\t\t\t\t\t\titem.title\n\t\t\t\t\t\t}\" title=\"Replace with another venue\">\n\t\t\t\t\t\t\t<span class=\"dashicons dashicons-update\"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class=\"batp-card__remove\" data-remove-slug=\"${\n\t\t\t\t\t\t\titem.slug\n\t\t\t\t\t\t}\" title=\"Remove from itinerary\">√ó</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"batp-card__header\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span class=\"batp-card__status\">${\n\t\t\t\t\t\t\t\tdetails.opening_hours?.open_now !== false\n\t\t\t\t\t\t\t\t\t? 'Open Now'\n\t\t\t\t\t\t\t\t\t: 'Check Hours'\n\t\t\t\t\t\t\t}</span>\n\t\t\t\t\t\t\t<h3 class=\"batp-card__title\">${ index + 1 }. ${ item.title }</h3>\n\t\t\t\t\t\t\t${\n\t\t\t\t\t\t\t\tdetails.rating\n\t\t\t\t\t\t\t\t\t? `<span class=\"batp-card__rating\">‚≠ê ${ details.rating }</span>`\n\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<p class=\"batp-card__description\">${ description }</p>\n\t\t\t\t\t\n\t\t\t\t\t<div class=\"batp-card__details\">\n\t\t\t\t\t\t${\n\t\t\t\t\t\t\taddress\n\t\t\t\t\t\t\t\t? `<div><span class=\"dashicons dashicons-location\"></span> ${ address }</div>`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t}\n\t\t\t\t\t\t<div><span class=\"dashicons dashicons-clock\"></span> ${ hours }</div>\n\t\t\t\t\t\t${\n\t\t\t\t\t\t\tphone\n\t\t\t\t\t\t\t\t? `<a href=\"tel:${ phone.replace(\n\t\t\t\t\t\t\t\t\t\t/[^0-9+]/g,\n\t\t\t\t\t\t\t\t\t\t''\n\t\t\t\t\t\t\t\t  ) }\" class=\"batp-card__link-row\" data-event-action=\"phone_click\" data-place-id=\"${ placeId }\"><span class=\"dashicons dashicons-phone\"></span> ${ phone }</a>`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"batp-card__footer\">\n\t\t\t\t\t\t<a href=\"${ dirUrl }\" target=\"_blank\" class=\"batp-card__btn-directions\" data-event-action=\"directions_click\" data-place-id=\"${ placeId }\">\n\t\t\t\t\t\t\t<span class=\"dashicons dashicons-location-alt\"></span> Directions\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<div class=\"batp-card__links\">\n\t\t\t\t\t\t\t${\n\t\t\t\t\t\t\t\twebsite !== '#'\n\t\t\t\t\t\t\t\t\t? `<a href=\"${ website }\" target=\"_blank\" data-event-action=\"website_click\" data-place-id=\"${ placeId }\" data-event-meta='${ JSON.stringify(\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\turl: website,\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t  ) }'><span class=\"dashicons dashicons-admin-site\"></span> Website</a>`\n\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\t\t} )\n\t\t\t\t\t.join( '' );\n\n\t\t\t// Handle remove button clicks\n\t\t\tlistOutput\n\t\t\t\t.querySelectorAll( '.batp-card__remove' )\n\t\t\t\t.forEach( ( btn ) => {\n\t\t\t\t\tbtn.addEventListener( 'click', ( e ) => {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tconst slugToRemove = btn.dataset.removeSlug;\n\t\t\t\t\t\tcurrentItems = currentItems.filter(\n\t\t\t\t\t\t\t( i ) => i.slug !== slugToRemove\n\t\t\t\t\t\t);\n\t\t\t\t\t\trenderList( currentItems );\n\t\t\t\t\t\t// Update meta text\n\t\t\t\t\t\tif ( metaText ) {\n\t\t\t\t\t\t\tconst duration = form.querySelector(\n\t\t\t\t\t\t\t\t'select[name=\"duration\"]'\n\t\t\t\t\t\t\t).value;\n\t\t\t\t\t\t\tmetaText.textContent = `${ currentItems.length } venues found ‚Ä¢ ${ duration } hours available`;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t} );\n\n\t\t\t// Handle replace button clicks\n\t\t\tlistOutput\n\t\t\t\t.querySelectorAll( '.batp-card__replace' )\n\t\t\t\t.forEach( ( btn ) => {\n\t\t\t\t\tbtn.addEventListener( 'click', ( e ) => {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treplacingSlug = btn.dataset.replaceSlug;\n\t\t\t\t\t\tconst replacingTitle = btn.dataset.replaceTitle;\n\t\t\t\t\t\topenReplaceModal( replacingSlug, replacingTitle );\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t};\n\n\t\t// Replace Modal Logic\n\t\tconst replaceModal = document.getElementById( 'batp-replace-modal' );\n\t\tconst replaceList = document.getElementById( 'batp-replace-list' );\n\t\tconst replaceCurrentName = document.getElementById(\n\t\t\t'batp-replace-current-name'\n\t\t);\n\n\t\tconst openReplaceModal = ( slug, title ) => {\n\t\t\tif ( ! replaceModal || ! replaceList ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Update modal title\n\t\t\tif ( replaceCurrentName ) {\n\t\t\t\treplaceCurrentName.textContent = title;\n\t\t\t}\n\n\t\t\t// Get available replacements\n\t\t\tconst available = getAvailableReplacements();\n\n\t\t\tif ( available.length === 0 ) {\n\t\t\t\treplaceList.innerHTML = `\n\t\t\t\t\t<p class=\"batp-replace-empty\">No alternative venues available. All candidates are already in your itinerary.</p>\n\t\t\t\t`;\n\t\t\t} else {\n\t\t\t\treplaceList.innerHTML = available\n\t\t\t\t\t.map( ( c ) => {\n\t\t\t\t\t\tconst rating = c.data?.rating\n\t\t\t\t\t\t\t? `${ c.data.rating }‚òÖ`\n\t\t\t\t\t\t\t: '';\n\t\t\t\t\t\tconst priceLevel = c.data?.price_level\n\t\t\t\t\t\t\t? '$'.repeat( c.data.price_level )\n\t\t\t\t\t\t\t: '';\n\t\t\t\t\t\treturn `\n\t\t\t\t\t\t<button class=\"batp-replace-option\" data-new-slug=\"${ c.slug }\">\n\t\t\t\t\t\t\t<div class=\"batp-replace-option__info\">\n\t\t\t\t\t\t\t\t<strong>${ c.data?.name || c.slug }</strong>\n\t\t\t\t\t\t\t\t<span>${ rating } ${ priceLevel }</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span class=\"dashicons dashicons-arrow-right-alt\"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t`;\n\t\t\t\t\t} )\n\t\t\t\t\t.join( '' );\n\n\t\t\t\t// Attach click handlers to replacement options\n\t\t\t\treplaceList\n\t\t\t\t\t.querySelectorAll( '.batp-replace-option' )\n\t\t\t\t\t.forEach( ( opt ) => {\n\t\t\t\t\t\topt.addEventListener( 'click', () => {\n\t\t\t\t\t\t\tconst newSlug = opt.dataset.newSlug;\n\t\t\t\t\t\t\tperformReplacement( replacingSlug, newSlug );\n\t\t\t\t\t\t\tcloseReplaceModal();\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t}\n\n\t\t\treplaceModal.classList.add( 'is-open' );\n\t\t\treplaceModal.setAttribute( 'aria-hidden', 'false' );\n\t\t};\n\n\t\tconst closeReplaceModal = () => {\n\t\t\tif ( replaceModal ) {\n\t\t\t\treplaceModal.classList.remove( 'is-open' );\n\t\t\t\treplaceModal.setAttribute( 'aria-hidden', 'true' );\n\t\t\t}\n\t\t\treplacingSlug = null;\n\t\t};\n\n\t\tconst performReplacement = ( oldSlug, newSlug ) => {\n\t\t\tconst newCandidate = allCandidates.find(\n\t\t\t\t( c ) => c.slug === newSlug\n\t\t\t);\n\t\t\tif ( ! newCandidate ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Find index of item to replace\n\t\t\tconst idx = currentItems.findIndex( ( i ) => i.slug === oldSlug );\n\t\t\tif ( idx === -1 ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Create new item from candidate\n\t\t\tconst newItem = {\n\t\t\t\tslug: newCandidate.slug,\n\t\t\t\ttitle: newCandidate.data?.name || newCandidate.slug,\n\t\t\t\tdescription: newCandidate.data?.vibe_summary || '',\n\t\t\t\torder: currentItems[ idx ].order,\n\t\t\t};\n\n\t\t\t// Replace in array\n\t\t\tcurrentItems[ idx ] = newItem;\n\n\t\t\t// Re-render\n\t\t\trenderList( currentItems );\n\n\t\t\t// Update meta text\n\t\t\tif ( metaText ) {\n\t\t\t\tconst duration = form.querySelector(\n\t\t\t\t\t'select[name=\"duration\"]'\n\t\t\t\t).value;\n\t\t\t\tmetaText.textContent = `${ currentItems.length } venues found ‚Ä¢ ${ duration } hours available`;\n\t\t\t}\n\n\t\t\t// Track analytics\n\t\t\ttrackEvent( 'item_replaced', null, {\n\t\t\t\told_slug: oldSlug,\n\t\t\t\tnew_slug: newSlug,\n\t\t\t} );\n\t\t};\n\n\t\t// Setup replace modal close handlers\n\t\tif ( replaceModal ) {\n\t\t\treplaceModal\n\t\t\t\t.querySelectorAll( '[data-modal-close]' )\n\t\t\t\t.forEach( ( el ) => {\n\t\t\t\t\tel.onclick = ( e ) => {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tcloseReplaceModal();\n\t\t\t\t\t};\n\t\t\t\t} );\n\t\t}\n\n\t\t// Initial Render\n\t\trenderList( currentItems );\n\n\t\t// --- MODAL LOGIC ---\n\t\tconst setupModal = ( modalId, triggerBtn ) => {\n\t\t\tconst modal = document.getElementById( modalId );\n\t\t\tif ( ! modal || ! triggerBtn ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst open = () => {\n\t\t\t\tmodal.classList.add( 'is-open' );\n\t\t\t\tmodal.setAttribute( 'aria-hidden', 'false' );\n\t\t\t};\n\n\t\t\tconst close = () => {\n\t\t\t\tmodal.classList.remove( 'is-open' );\n\t\t\t\tmodal.setAttribute( 'aria-hidden', 'true' );\n\t\t\t};\n\n\t\t\ttriggerBtn.onclick = ( e ) => {\n\t\t\t\te.preventDefault();\n\t\t\t\topen();\n\t\t\t};\n\n\t\t\t// Close triggers\n\t\t\tmodal.querySelectorAll( '[data-modal-close]' ).forEach( ( el ) => {\n\t\t\t\tel.onclick = ( e ) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tclose();\n\t\t\t\t};\n\t\t\t} );\n\t\t};\n\n\t\t// Share Modal\n\t\tconst shareBtn = document.querySelector(\n\t\t\t'.batp-results__btn--primary'\n\t\t);\n\t\tsetupModal( 'batp-share-modal', shareBtn );\n\n\t\tif ( shareBtn ) {\n\t\t\t// Populate Summary on click\n\t\t\tshareBtn.addEventListener( 'click', () => {\n\t\t\t\tconst summaryList =\n\t\t\t\t\tdocument.getElementById( 'batp-summary-list' );\n\t\t\t\tif ( summaryList ) {\n\t\t\t\t\tsummaryList.innerHTML = itineraryItems\n\t\t\t\t\t\t.map( ( item ) => `<li>${ item.title }</li>` )\n\t\t\t\t\t\t.join( '' );\n\t\t\t\t}\n\t\t\t\t// Update Link\n\t\t\t\tconst linkInput = document.getElementById(\n\t\t\t\t\t'batp-share-link-input'\n\t\t\t\t);\n\t\t\t\tif ( linkInput ) {\n\t\t\t\t\tlinkInput.value = window.location.href;\n\t\t\t\t} // Simple mock\n\t\t\t} );\n\t\t}\n\n\t\t// Copy Link Logic\n\t\tconst copyBtn = document.getElementById( 'batp-btn-copy-link' );\n\t\tif ( copyBtn ) {\n\t\t\tcopyBtn.onclick = () => {\n\t\t\t\tconst input = document.getElementById(\n\t\t\t\t\t'batp-share-link-input'\n\t\t\t\t);\n\t\t\t\tinput.select();\n\t\t\t\tnavigator.clipboard.writeText( input.value );\n\t\t\t\tconst original = copyBtn.innerText;\n\t\t\t\tcopyBtn.innerText = 'Copied!';\n\t\t\t\tsetTimeout( () => ( copyBtn.innerText = original ), 2000 );\n\t\t\t\ttrackEvent( 'share_copy_link', null, { method: 'copy' } );\n\t\t\t};\n\t\t}\n\n\t\t// Helper: Build itinerary text for sharing\n\t\tconst buildShareText = () => {\n\t\t\tconst title = 'My Brooklyn Adventure';\n\t\t\tconst venueList = itineraryItems\n\t\t\t\t.map( ( item, i ) => `${ i + 1 }. ${ item.title }` )\n\t\t\t\t.join( '\\n' );\n\t\t\treturn `${ title }\\n\\n${ venueList }\\n\\nPlan yours at: ${ window.location.href }`;\n\t\t};\n\n\t\t// Download PDF - uses browser print dialog\n\t\tconst pdfBtn = document.getElementById( 'batp-btn-download-pdf' );\n\t\tif ( pdfBtn ) {\n\t\t\tpdfBtn.onclick = () => {\n\t\t\t\t// Create printable content\n\t\t\t\tconst printContent = `\n\t\t\t\t\t<!DOCTYPE html>\n\t\t\t\t\t<html>\n\t\t\t\t\t<head>\n\t\t\t\t\t\t<title>Brooklyn Itinerary</title>\n\t\t\t\t\t\t<style>\n\t\t\t\t\t\t\tbody { font-family: 'Inter', -apple-system, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }\n\t\t\t\t\t\t\th1 { color: #8B4513; border-bottom: 2px solid #8B4513; padding-bottom: 10px; }\n\t\t\t\t\t\t\t.venue { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }\n\t\t\t\t\t\t\t.venue h2 { margin: 0 0 8px 0; color: #333; font-size: 18px; }\n\t\t\t\t\t\t\t.venue p { margin: 4px 0; color: #666; font-size: 14px; }\n\t\t\t\t\t\t\t.footer { margin-top: 40px; text-align: center; color: #999; font-size: 12px; }\n\t\t\t\t\t\t</style>\n\t\t\t\t\t</head>\n\t\t\t\t\t<body>\n\t\t\t\t\t\t<h1>My Brooklyn Adventure</h1>\n\t\t\t\t\t\t<p>Generated on ${ new Date().toLocaleDateString() }</p>\n\t\t\t\t\t\t${ itineraryItems\n\t\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t\t( item, i ) => `\n\t\t\t\t\t\t\t<div class=\"venue\">\n\t\t\t\t\t\t\t\t<h2>${ i + 1 }. ${ item.title }</h2>\n\t\t\t\t\t\t\t\t<p>${ item.address || '' }</p>\n\t\t\t\t\t\t\t\t${ item.phone ? `<p>Phone: ${ item.phone }</p>` : '' }\n\t\t\t\t\t\t\t\t${ item.website ? `<p>Website: ${ item.website }</p>` : '' }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.join( '' ) }\n\t\t\t\t\t\t<div class=\"footer\">\n\t\t\t\t\t\t\t<p>Created with Brooklyn AI Trip Planner</p>\n\t\t\t\t\t\t\t<p>${ window.location.origin }</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</body>\n\t\t\t\t\t</html>\n\t\t\t\t`;\n\n\t\t\t\t// Track event first (before potential popup blocker issues)\n\t\t\t\ttrackEvent( 'share_download_pdf', null, {\n\t\t\t\t\tvenues: itineraryItems.length,\n\t\t\t\t} );\n\n\t\t\t\tconst printWindow = window.open( '', '_blank' );\n\t\t\t\tif ( ! printWindow ) {\n\t\t\t\t\talert(\n\t\t\t\t\t\t'Please allow popups for this site to download your itinerary.'\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tprintWindow.document.write( printContent );\n\t\t\t\tprintWindow.document.close();\n\t\t\t\tprintWindow.print();\n\t\t\t};\n\t\t}\n\n\t\t// Add to Calendar (ICS)\n\t\tconst calBtn = document.getElementById( 'batp-btn-add-calendar' );\n\t\tif ( calBtn ) {\n\t\t\tcalBtn.onclick = () => {\n\t\t\t\tconst now = new Date();\n\t\t\t\tconst tomorrow = new Date( now );\n\t\t\t\ttomorrow.setDate( tomorrow.getDate() + 1 );\n\t\t\t\ttomorrow.setHours( 10, 0, 0, 0 );\n\n\t\t\t\tconst formatDate = ( d ) =>\n\t\t\t\t\td.toISOString().replace( /[-:]/g, '' ).split( '.' )[ 0 ] +\n\t\t\t\t\t'Z';\n\n\t\t\t\tconst venues = itineraryItems\n\t\t\t\t\t.map( ( v ) => v.title )\n\t\t\t\t\t.join( ', ' );\n\t\t\t\tconst description = `Brooklyn Adventure:\\\\n\\\\n${ itineraryItems\n\t\t\t\t\t.map(\n\t\t\t\t\t\t( v, i ) =>\n\t\t\t\t\t\t\t`${ i + 1 }. ${ v.title }${\n\t\t\t\t\t\t\t\tv.address ? ' - ' + v.address : ''\n\t\t\t\t\t\t\t}`\n\t\t\t\t\t)\n\t\t\t\t\t.join( '\\\\n' ) }`;\n\n\t\t\t\tconst icsContent = [\n\t\t\t\t\t'BEGIN:VCALENDAR',\n\t\t\t\t\t'VERSION:2.0',\n\t\t\t\t\t'PRODID:-//Brooklyn AI Trip Planner//EN',\n\t\t\t\t\t'BEGIN:VEVENT',\n\t\t\t\t\t`UID:${ Date.now() }@visitbrooklynnyc`,\n\t\t\t\t\t`DTSTAMP:${ formatDate( now ) }`,\n\t\t\t\t\t`DTSTART:${ formatDate( tomorrow ) }`,\n\t\t\t\t\t`DTEND:${ formatDate(\n\t\t\t\t\t\tnew Date( tomorrow.getTime() + 4 * 60 * 60 * 1000 )\n\t\t\t\t\t) }`,\n\t\t\t\t\t`SUMMARY:Brooklyn Adventure`,\n\t\t\t\t\t`DESCRIPTION:${ description }`,\n\t\t\t\t\t`LOCATION:${ venues }`,\n\t\t\t\t\t'END:VEVENT',\n\t\t\t\t\t'END:VCALENDAR',\n\t\t\t\t].join( '\\r\\n' );\n\n\t\t\t\tconst blob = new Blob( [ icsContent ], {\n\t\t\t\t\ttype: 'text/calendar;charset=utf-8',\n\t\t\t\t} );\n\t\t\t\tconst link = document.createElement( 'a' );\n\t\t\t\tlink.href = URL.createObjectURL( blob );\n\t\t\t\tlink.download = 'brooklyn-itinerary.ics';\n\t\t\t\tlink.click();\n\t\t\t\tURL.revokeObjectURL( link.href );\n\t\t\t\ttrackEvent( 'share_add_calendar', null, {\n\t\t\t\t\tvenues: itineraryItems.length,\n\t\t\t\t} );\n\t\t\t};\n\t\t}\n\n\t\t// Share via Email\n\t\tconst emailBtn = document.getElementById( 'batp-btn-share-email' );\n\t\tif ( emailBtn ) {\n\t\t\temailBtn.onclick = () => {\n\t\t\t\tconst subject = encodeURIComponent(\n\t\t\t\t\t'Check out my Brooklyn itinerary!'\n\t\t\t\t);\n\t\t\t\tconst body = encodeURIComponent( buildShareText() );\n\t\t\t\twindow.open(\n\t\t\t\t\t`mailto:?subject=${ subject }&body=${ body }`,\n\t\t\t\t\t'_self'\n\t\t\t\t);\n\t\t\t\ttrackEvent( 'share_email', null, {\n\t\t\t\t\tvenues: itineraryItems.length,\n\t\t\t\t} );\n\t\t\t};\n\t\t}\n\n\t\t// Share via SMS\n\t\tconst smsBtn = document.getElementById( 'batp-btn-share-sms' );\n\t\tif ( smsBtn ) {\n\t\t\tsmsBtn.onclick = () => {\n\t\t\t\tconst text = encodeURIComponent( buildShareText() );\n\t\t\t\t// Use sms: protocol (works on mobile)\n\t\t\t\twindow.open( `sms:?body=${ text }`, '_self' );\n\t\t\t\ttrackEvent( 'share_sms', null, {\n\t\t\t\t\tvenues: itineraryItems.length,\n\t\t\t\t} );\n\t\t\t};\n\t\t}\n\n\t\t// Social Media Sharing\n\t\tconst shareUrl = encodeURIComponent( window.location.href );\n\t\tconst shareText = encodeURIComponent(\n\t\t\t`I just planned a Brooklyn adventure with ${ itineraryItems.length } stops!`\n\t\t);\n\n\t\t// Facebook\n\t\tconst fbBtn = document.getElementById( 'batp-btn-share-facebook' );\n\t\tif ( fbBtn ) {\n\t\t\tfbBtn.onclick = () => {\n\t\t\t\twindow.open(\n\t\t\t\t\t`https://www.facebook.com/sharer/sharer.php?u=${ shareUrl }`,\n\t\t\t\t\t'_blank',\n\t\t\t\t\t'width=600,height=400'\n\t\t\t\t);\n\t\t\t\ttrackEvent( 'share_social', null, { platform: 'facebook' } );\n\t\t\t};\n\t\t}\n\n\t\t// X (Twitter)\n\t\tconst xBtn = document.getElementById( 'batp-btn-share-x' );\n\t\tif ( xBtn ) {\n\t\t\txBtn.onclick = () => {\n\t\t\t\twindow.open(\n\t\t\t\t\t`https://twitter.com/intent/tweet?url=${ shareUrl }&text=${ shareText }`,\n\t\t\t\t\t'_blank',\n\t\t\t\t\t'width=600,height=400'\n\t\t\t\t);\n\t\t\t\ttrackEvent( 'share_social', null, { platform: 'x' } );\n\t\t\t};\n\t\t}\n\n\t\t// WhatsApp\n\t\tconst waBtn = document.getElementById( 'batp-btn-share-whatsapp' );\n\t\tif ( waBtn ) {\n\t\t\twaBtn.onclick = () => {\n\t\t\t\twindow.open(\n\t\t\t\t\t`https://wa.me/?text=${ shareText }%20${ shareUrl }`,\n\t\t\t\t\t'_blank'\n\t\t\t\t);\n\t\t\t\ttrackEvent( 'share_social', null, { platform: 'whatsapp' } );\n\t\t\t};\n\t\t}\n\n\t\t// LinkedIn\n\t\tconst liBtn = document.getElementById( 'batp-btn-share-linkedin' );\n\t\tif ( liBtn ) {\n\t\t\tliBtn.onclick = () => {\n\t\t\t\twindow.open(\n\t\t\t\t\t`https://www.linkedin.com/sharing/share-offsite/?url=${ shareUrl }`,\n\t\t\t\t\t'_blank',\n\t\t\t\t\t'width=600,height=400'\n\t\t\t\t);\n\t\t\t\ttrackEvent( 'share_social', null, { platform: 'linkedin' } );\n\t\t\t};\n\t\t}\n\n\t\t// Instagram - Opens Instagram app/web (no direct share API, so we copy to clipboard and open)\n\t\tconst igBtn = document.getElementById( 'batp-btn-share-instagram' );\n\t\tif ( igBtn ) {\n\t\t\tigBtn.onclick = () => {\n\t\t\t\tconst text = buildShareText();\n\t\t\t\tnavigator.clipboard.writeText( text ).then( () => {\n\t\t\t\t\talert(\n\t\t\t\t\t\t'Itinerary copied to clipboard! Opening Instagram - paste in your story or post.'\n\t\t\t\t\t);\n\t\t\t\t\twindow.open( 'https://www.instagram.com/', '_blank' );\n\t\t\t\t} );\n\t\t\t\ttrackEvent( 'share_social', null, { platform: 'instagram' } );\n\t\t\t};\n\t\t}\n\n\t\t// TikTok - Similar to Instagram, no direct share API\n\t\tconst ttBtn = document.getElementById( 'batp-btn-share-tiktok' );\n\t\tif ( ttBtn ) {\n\t\t\tttBtn.onclick = () => {\n\t\t\t\tconst text = buildShareText();\n\t\t\t\tnavigator.clipboard.writeText( text ).then( () => {\n\t\t\t\t\talert(\n\t\t\t\t\t\t'Itinerary copied to clipboard! Opening TikTok - paste in your video description.'\n\t\t\t\t\t);\n\t\t\t\t\twindow.open( 'https://www.tiktok.com/', '_blank' );\n\t\t\t\t} );\n\t\t\t\ttrackEvent( 'share_social', null, { platform: 'tiktok' } );\n\t\t\t};\n\t\t}\n\n\t\t// Filter Modal\n\t\tconst filterBtn = document.querySelector(\n\t\t\t'.batp-results__btn:nth-child(2)'\n\t\t);\n\t\tsetupModal( 'batp-filter-modal', filterBtn );\n\n\t\t// Apply Filters Logic\n\t\tconst applyBtn = document.getElementById( 'batp-apply-filters' );\n\t\tif ( applyBtn ) {\n\t\t\tapplyBtn.onclick = () => {\n\t\t\t\tconst modal = document.getElementById( 'batp-filter-modal' );\n\n\t\t\t\t// Get checked values\n\t\t\t\tconst wheelchair = modal.querySelector(\n\t\t\t\t\t'input[name=\"access_wheelchair\"]'\n\t\t\t\t).checked;\n\t\t\t\tconst sensory = modal.querySelector(\n\t\t\t\t\t'input[name=\"access_sensory\"]'\n\t\t\t\t).checked;\n\t\t\t\tconst seating = modal.querySelector(\n\t\t\t\t\t'input[name=\"access_seating\"]'\n\t\t\t\t).checked;\n\n\t\t\t\t// Filter items\n\t\t\t\tconst cards = listOutput.querySelectorAll( '.batp-card' );\n\t\t\t\tcards.forEach( ( card ) => {\n\t\t\t\t\tconst access = JSON.parse( card.dataset.access || '[]' );\n\t\t\t\t\tlet visible = true;\n\n\t\t\t\t\tif ( wheelchair && ! access.includes( 'wheelchair' ) ) {\n\t\t\t\t\t\tvisible = false;\n\t\t\t\t\t}\n\t\t\t\t\tif ( sensory && ! access.includes( 'sensory' ) ) {\n\t\t\t\t\t\tvisible = false;\n\t\t\t\t\t}\n\t\t\t\t\tif ( seating && ! access.includes( 'seating' ) ) {\n\t\t\t\t\t\tvisible = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tcard.style.display = visible ? 'flex' : 'none';\n\t\t\t\t} );\n\n\t\t\t\t// Close modal\n\t\t\t\tmodal.classList.remove( 'is-open' );\n\t\t\t};\n\t\t}\n\n\t\t// Init Map\n\t\tif ( apiKey && locations.length > 0 ) {\n\t\t\t// Small delay to ensure container is visible/sized\n\t\t\tsetTimeout( () => {\n\t\t\t\tinitMap( apiKey, locations );\n\t\t\t}, 100 );\n\t\t}\n\t};\n\n\t// 5. Analytics Logic\n\tconst trackEvent = async ( action, placeId, metadata = {} ) => {\n\t\tconst nonce = form.dataset.nonce;\n\t\tconst restNonce = form.dataset.restNonce;\n\t\tconst baseApiUrl = form.dataset.apiUrl; // .../v1/itinerary\n\t\tconst eventsUrl = baseApiUrl.replace( '/itinerary', '/events' );\n\n\t\tconsole.log( 'BATP trackEvent:', action, placeId, metadata );\n\n\t\tif ( ! nonce || ! eventsUrl ) {\n\t\t\tconsole.warn( 'BATP trackEvent: Missing nonce or eventsUrl' );\n\t\t\treturn;\n\t\t}\n\n\t\t// Default metadata to avoid empty object issues\n\t\tconst finalMeta = { ...metadata, source: 'web_client' };\n\n\t\ttry {\n\t\t\tconst response = await fetch( eventsUrl, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tkeepalive: true,\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t...( restNonce ? { 'X-WP-Nonce': restNonce } : {} ),\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify( {\n\t\t\t\t\taction_type: action,\n\t\t\t\t\tplace_id: placeId, // Use place_id for Google Places\n\t\t\t\t\tmetadata: finalMeta,\n\t\t\t\t\tnonce,\n\t\t\t\t} ),\n\t\t\t} );\n\t\t\tconsole.log(\n\t\t\t\t'BATP trackEvent response:',\n\t\t\t\tresponse.status,\n\t\t\t\tresponse.ok\n\t\t\t);\n\t\t} catch ( err ) {\n\t\t\tconsole.warn( 'BATP Analytics fail:', err );\n\t\t}\n\t};\n\n\t// Event Delegation - Track clicks on website/directions\n\tif ( listOutput ) {\n\t\tlistOutput.addEventListener( 'click', ( e ) => {\n\t\t\tconst target = e.target.closest( '[data-event-action]' );\n\t\t\tif ( target ) {\n\t\t\t\tconst action = target.dataset.eventAction;\n\t\t\t\tconst placeId = target.dataset.placeId || ''; // Use place_id for Google Places\n\t\t\t\tconst meta = target.dataset.eventMeta\n\t\t\t\t\t? JSON.parse( target.dataset.eventMeta )\n\t\t\t\t\t: {};\n\n\t\t\t\tconsole.log( 'BATP Analytics:', action, placeId, meta );\n\t\t\t\ttrackEvent( action, placeId, meta );\n\t\t\t}\n\t\t} );\n\t}\n\n\t// 4. Form Submission\n\tform.addEventListener( 'submit', async ( event ) => {\n\t\tevent.preventDefault();\n\n\t\tconst nonce = form.dataset.nonce;\n\t\tconst restNonce = form.dataset.restNonce;\n\t\tconst apiUrl = form.dataset.apiUrl;\n\t\tconst apiKey = form.dataset.googleMapsKey;\n\n\t\tif ( ! nonce || ! apiUrl ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst formData = new FormData( form );\n\n\t\t// Get lat/lng from hidden inputs (populated by neighborhood selection)\n\t\tconst lat = parseFloat( formData.get( 'latitude' ) ) || 40.6782;\n\t\tconst lng = parseFloat( formData.get( 'longitude' ) ) || -73.9442;\n\t\tconst selectedNeighborhood = formData.get( 'neighborhood' );\n\n\t\tconsole.log( 'BATP Form: Submitting with location:', {\n\t\t\tneighborhood: selectedNeighborhood,\n\t\t\tlat,\n\t\t\tlng,\n\t\t} );\n\n\t\tconst payload = {\n\t\t\tneighborhood: selectedNeighborhood,\n\t\t\tlat,\n\t\t\tlng,\n\t\t\tinterests: formData.getAll( 'interests[]' ),\n\t\t\tbudget: formData.get( 'budget' ),\n\t\t\tduration: Number( formData.get( 'duration' ) ) * 60,\n\t\t\tnonce,\n\t\t};\n\n\t\t// UI State: Loading\n\t\tconst submitBtn = form.querySelector( 'button[type=\"submit\"]' );\n\t\tconst originalBtnText = submitBtn.innerHTML;\n\t\tsubmitBtn.disabled = true;\n\t\tsubmitBtn.innerHTML = 'Generating Plan...';\n\n\t\ttry {\n\t\t\tconst response = await fetch( apiUrl, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t...( restNonce ? { 'X-WP-Nonce': restNonce } : {} ),\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify( payload ),\n\t\t\t} );\n\n\t\t\tconst result = await response.json();\n\n\t\t\tif ( ! response.ok ) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\tresult.message || 'Error generating itinerary'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Note: itinerary_generated is logged by backend Engine, not frontend\n\t\t\t// to avoid double-counting\n\n\t\t\trenderResults( result, apiKey );\n\t\t} catch ( error ) {\n\t\t\tconsole.error( 'BATP Error:', error );\n\t\t\talert( 'Error: ' + error.message );\n\t\t} finally {\n\t\t\tsubmitBtn.disabled = false;\n\t\t\tsubmitBtn.innerHTML = originalBtnText;\n\t\t}\n\t} );\n};\n\nif ( document.readyState !== 'loading' ) {\n\tinitItineraryForm();\n} else {\n\tdocument.addEventListener( 'DOMContentLoaded', initItineraryForm );\n}\n"],"names":["initItineraryForm","form","document","querySelector","resultsArea","getElementById","listOutput","mapContainer","metaText","tabs","querySelectorAll","chips","Array","from","neighborhoodSelect","latInput","lngInput","locationStatus","setLocationFromOption","option","dataset","lat","lng","value","textContent","selectedOption","options","selectedIndex","addEventListener","e","target","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","console","log","error","alert","enableHighAccuracy","timeout","forEach","input","closest","classList","toggle","checked","tab","t","remove","add","targetId","content","googleMap","setTimeout","google","maps","event","trigger","waitForGoogleMaps","Promise","resolve","reject","attempts","check","window","Map","Error","loadGoogleMaps","apiKey","existingScript","script","createElement","src","async","defer","onload","onerror","err","head","appendChild","initMap","locations","MapConstructor","AdvancedMarkerElement","useLegacyMarkers","importLibrary","AME","warn","center","length","zoom","mapId","disableDefaultUI","zoomControl","streetViewControl","bounds","LatLngBounds","loc","index","markerContent","className","innerHTML","map","title","Marker","label","text","toString","color","fontWeight","extend","fitBounds","renderResults","data","itineraryItems","itinerary","items","scrollIntoView","behavior","duration","candidateMap","candidates","c","slug","multiStopDirectionsUrl","directions","overview_url","item","idx","candidate","get","push","parseFloat","placeId","getHoursString","hoursData","days","dayName","Date","getDay","buildMultiStopUrl","locs","origin","destination","waypoints","slice","l","join","url","fullRouteUrl","generateDescription","details","itemDesc","vibe_summary","parts","rating","priceLevel","price_level","repeat","types","replace","currentItems","allCandidates","getAvailableReplacements","currentSlugs","Set","i","filter","has","replacingSlug","renderList","headerHtml","website","phone","phone_number","address","description","hours","opening_hours","open_now","dirUrl","encodeURIComponent","place_id","JSON","stringify","accessibility","btn","preventDefault","slugToRemove","removeSlug","replaceSlug","replacingTitle","replaceTitle","openReplaceModal","replaceModal","replaceList","replaceCurrentName","available","name","opt","newSlug","performReplacement","closeReplaceModal","setAttribute","oldSlug","newCandidate","find","findIndex","newItem","order","trackEvent","old_slug","new_slug","el","onclick","setupModal","modalId","triggerBtn","modal","open","close","shareBtn","summaryList","linkInput","location","href","copyBtn","select","clipboard","writeText","original","innerText","method","buildShareText","venueList","pdfBtn","printContent","toLocaleDateString","venues","printWindow","write","print","calBtn","now","tomorrow","setDate","getDate","setHours","formatDate","d","toISOString","split","v","icsContent","getTime","blob","Blob","type","link","URL","createObjectURL","download","click","revokeObjectURL","emailBtn","subject","body","smsBtn","shareUrl","shareText","fbBtn","platform","xBtn","waBtn","liBtn","igBtn","then","ttBtn","filterBtn","applyBtn","wheelchair","sensory","seating","cards","card","access","parse","visible","includes","style","display","action","metadata","nonce","restNonce","baseApiUrl","apiUrl","eventsUrl","finalMeta","source","response","fetch","keepalive","headers","action_type","status","ok","eventAction","meta","eventMeta","googleMapsKey","formData","FormData","selectedNeighborhood","neighborhood","payload","interests","getAll","budget","Number","submitBtn","originalBtnText","disabled","result","json","message","readyState"],"ignoreList":[],"sourceRoot":""}